<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="../css/bootstrap.min.css" rel="stylesheet"/>
    <title>新增页</title>
    <style>
        .container table tr td {
            vertical-align: middle;
            text-align: center;
        }
    </style>
</head>
<body class="container">
<h1 align="center">新增页</h1>
<form class="form-horizontal" id="addForm" action="/edit.action" >
    <div class="form-group">
        <label class="col-sm-2 control-label">指令名称</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" id="commandName">
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">描述</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" id="description">
        </div>
    </div>


    <table class="table table-condensed table-striped">
        <tr>
            <th>序号</th>
            <th>内容</th>
            <th>操作</th>
        </tr>
        <tr>
            <td>1</td>
            <td>
                <textarea class="form-control" name="content"></textarea>
            </td>
            <td><a class="btn btn-danger btn-sm delete-btn">delete</a></td>
        </tr>

        <tr id="add-tr">
            <td></td>
            <td></td>
            <td><a id="add" class="btn btn-primary btn-sm">add</a></td>
        </tr>
    </table>

    <button type="button" class="btn btn-primary" id="btn1">新增</button>
</form>
<script src="../js/common/jquery-1.8.0.min.js"></script>
<script>
    var $table = $('.table');
    var $addBtn = $('#add');
    var $addTr = $('#add-tr');
    var $template = $('<tr> ' +
        '<td class="index">1</td> ' +
        '<td> <textarea class="form-control" name="content"></textarea> </td> ' +
        '<td><button class="btn btn-danger btn-sm delete-btn">delete</button></td> ' +
        '</tr>')
    $addBtn.on('click', function (e) {
        stop(e);
        var $newTr = $template.clone();
        $addTr.before($newTr);
        sortIndex();
    });

    $table.on('click', '.delete-btn', function (e) {
        stop(e);
        var $btn = $(e.target);
        var $tr = $btn.parents('tr')
        $tr.remove();
        sortIndex();
    })

    function stop(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    function sortIndex() {
        $('tr').each(function (index, ele) {
            if (index === 0) return;
            $(ele).find('.index').html(index);
        })
    }

    var targetUrl = $("#addForm").attr("action");
    $("#btn1").click(function () {
        var comments = [];
        $("[name='content']").each(function () {
            comments.push($(this).val());
        });

        $.ajax({
            type: 'POST',
            url: targetUrl,
            traditional: true,
            datatype: "json",
            data: {
                'commandName': $("#commandName").val(),
                'description': $("#description").val(),
                'contents': comments
            },
            success: function (returndata) {
                if (returndata.isSuccess) {
                    alert("OK!");
                }
            }
        });

    });
</script>
</body>
</html>